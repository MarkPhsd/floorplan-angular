import { fabric } from 'fabric';
const { Group, Rect, Line, Circle, Ellipse, Path, Polygon, Polyline, Triangle } = fabric;
const RL_FILL = 'white', RL_STROKE = 'green', RL_STROKE_InUse = 'yello', RL_STROKE_NoReady = 'red', RL_PREVIEW_WIDTH = 140, RL_PREVIEW_HEIGHT = 120, RL_CHAIR_STROKE = 'white', RL_CHAIR_FILL = 'purple', RL_CHAIR_TUCK = 6, RL_VIEW_WIDTH = 120, RL_VIEW_HEIGHT = 56, RL_FOOT = 12, RL_AISLEGAP = 12 * 3, RL_ROOM_OUTER_SPACING = 48, RL_ROOM_INNER_SPACING = 4, RL_ROOM_STROKE = '#000', RL_CORNER_FILL = '#88f', RL_UNGROUPABLES = ['CHAIR', 'MISCELLANEOUS', 'DOOR'], RL_CREDIT_TEXT = '', RL_CREDIT_TEXT_PARAMS = { fontSize: 12, fontFamily: 'Arial', fill: '#999', left: 12 };
const createText = (properties) => {
    let { text } = properties;
    if (properties.direction === 'VERTICAL') {
        const chars = [];
        for (const char of text) {
            chars.push(char);
        }
        text = chars.join('\n');
    }
    return new fabric.IText(text, {
        fontSize: properties.font_size,
        lineHeight: 0.8,
        name: properties.name,
        hasControls: false
    });
};
/** Create Basic Shape  */
const createBasicShape = (part, stroke = '#aaaaaa', fill = 'white') => {
    if (part.definition.fill == null)
        part.definition.fill = fill;
    if (part.definition.stroke == null)
        part.definition.stroke = stroke;
    else if (part.definition.stroke == 'chair')
        part.definition.stroke = RL_CHAIR_STROKE;
    let fObj;
    switch (part.type) {
        case 'circle':
            fObj = new Circle(part.definition);
            break;
        case 'ellipse':
            fObj = new Ellipse(part.definition);
            break;
        case 'line':
            fObj = new Line(part.line, part.definition);
            break;
        case 'path':
            fObj = new Path(part.path, part.definition);
            break;
        case 'polygon':
            fObj = new Polygon(part.definition);
            break;
        case 'polyline':
            fObj = new Polyline(part.definition);
            break;
        case 'rect':
            fObj = new Rect(part.definition);
            break;
        case 'triangle':
            fObj = new Triangle(part.definition);
            break;
    }
    return (fObj);
};
const createFurniture = (type, object, chair = {}) => {
    if (type === 'TABLE') {
        // console.log('chair', chair)
        // console.log('object', object)
        return createTable(object, chair);
    }
    else if (type === 'TEXT') {
        return createText(object);
    }
    else if (type === 'LAYOUT') {
        return object;
    }
    else {
        return createShape(object, RL_STROKE, RL_FILL, type);
    }
};
/** Adding Chairs */
const createShape = (object, stroke = RL_CHAIR_STROKE, fill = RL_CHAIR_FILL, type = 'CHAIR') => {
    const parts = object.parts.map(obj => createBasicShape(obj, stroke, fill));
    const group = new Group(parts, {
        name: `${type}`,
        hasControls: false,
        originX: 'center',
        originY: 'center'
    });
    return group;
};
// All Create[Name]Object() functions should return a group
const createTable = (def, RL_DEFAULT_CHAIR, type = 'TABLE') => {
    // tables with chairs have the chairs full-height around the table
    // create table name passing from def
    // console.log('createTable def', def?.name)
    // console.log('createTable def RL_DEFAULT_CHAIR', def?.name)
    const components = [];
    let index = 0;
    // Note that we're using the provided width and height for table placement
    // Issues may arise if rendered shape is larger/smaller, since it's positioned from center point
    const chairWidth = RL_DEFAULT_CHAIR.width;
    const chairHeight = RL_DEFAULT_CHAIR.height;
    const tableLeft = def.leftChairs > 0 ? (chairHeight - RL_CHAIR_TUCK) : 0;
    const tableTop = (chairHeight - RL_CHAIR_TUCK);
    if (def.shape == 'circle') {
        const origin_x = def.width / 2 + chairHeight - RL_CHAIR_TUCK;
        const origin_y = def.width / 2 + chairHeight - RL_CHAIR_TUCK;
        const x2 = origin_x;
        const y2 = 0 + chairHeight / 2;
        const rotation_origin = new fabric.Point(origin_x, origin_y);
        const tableRadius = def.width / 2;
        const radius = def.width / 2 + chairHeight; // outer radius of whole shape unit
        let angle = 0;
        const angleIncrement = 360 / (def.chairs > 0 ? def.chairs : 1);
        for (let x = 0; x < def.chairs; ++x) {
            // Note that width and height are the same for circle tables
            // width of whole area when done
            const width = def.width + chairHeight - (RL_CHAIR_TUCK * 2);
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            const angle_radians = fabric.util.degreesToRadians(angle);
            const end = fabric.util.rotatePoint(new fabric.Point(x2, y2), rotation_origin, angle_radians);
            components[index].left = end.x;
            components[index].top = end.y;
            components[index].angle = (angle + 180 > 360) ? (angle - 180) : (angle + 180);
            index++;
            angle += angleIncrement;
        }
        if (def.fill === '') {
            def.fill = RL_FILL;
            def.stroke = RL_STROKE;
        }
        const tableCircle = {
            left: origin_x,
            top: origin_y,
            radius: tableRadius,
            fill: def.fill,
            stroke: def.stroke,
            originX: 'center',
            originY: 'center',
            name: def?.name + ';orderid;itemName;'
        };
        components[index] = new fabric.Circle(tableCircle);
    }
    else if (def.shape == 'rect') {
        const tableRect = {
            width: def.width,
            height: def.height,
            fill: RL_FILL,
            stroke: RL_STROKE,
            name: def?.name + ';orderid;itemName;'
        };
        // calculate gap between chairs, with extra for gap to end of table
        let gap = 0, firstOffset = 0, leftOffset = 0, topOffset = 0;
        // top chair row
        // Note that chairs 'look up' by default, so the bottom row isn't rotated
        // and the top row is.
        gap = (def.width - (def.topChairs * chairWidth)) / (def.topChairs + 1);
        firstOffset = gap + tableLeft;
        leftOffset = firstOffset;
        topOffset = 0;
        for (let x = 0; x < def.topChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].angle = -180;
            components[index].left = leftOffset + chairWidth / 2;
            components[index].top = topOffset + chairHeight / 2;
            index++;
            leftOffset += (chairWidth + gap);
        }
        // bottom chair row
        gap = (def.width - (def.bottomChairs * chairWidth)) / (def.bottomChairs + 1);
        firstOffset = gap + tableLeft;
        leftOffset = firstOffset;
        topOffset = tableRect.height + chairHeight - (RL_CHAIR_TUCK * 2);
        for (let x = 0; x < def.bottomChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].left = leftOffset + chairWidth / 2;
            components[index].top = topOffset + chairWidth / 2;
            ++index;
            leftOffset += (chairWidth + gap);
        }
        // left chair row
        gap = (def.height - (def.leftChairs * chairWidth)) / (def.leftChairs + 1);
        leftOffset = chairWidth / 2;
        topOffset = tableTop + gap + chairWidth / 2; // top of table plus first gap, then to center
        for (let x = 0; x < def.leftChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].angle = 90;
            components[index].left = leftOffset;
            components[index].top = topOffset;
            ++index;
            topOffset += (chairWidth + gap);
        }
        // right chair row
        gap = (def.height - (def.rightChairs * chairWidth)) / (def.rightChairs + 1);
        leftOffset = tableRect.width + chairWidth / 2;
        topOffset = tableTop + gap + chairWidth / 2; // top of table plus first gap, then to center
        for (let x = 0; x < def.rightChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].angle = -90;
            components[index].left = leftOffset + chairHeight - (RL_CHAIR_TUCK * 2);
            components[index].top = topOffset;
            ++index;
            topOffset += (chairWidth + gap);
        }
        // add table on top of chairs
        components[index] = new fabric.Rect(tableRect);
        components[index].left = tableLeft;
        components[index].top = tableTop;
    }
    const tableGroup = new fabric.Group(components, {
        left: 0,
        top: 0,
        hasControls: false,
        // set origin for all groups to center
        originX: 'center',
        originY: 'center',
        name: def?.name + ';orderid;itemName;',
        borderColor: 'purple',
        backgroundColor: 'purple',
        stroke: 'purple',
        strokeWidth: 10,
        fill: 'purple'
    });
    return tableGroup;
};
export { createBasicShape, createTable, createShape, createText, createFurniture, RL_FILL, RL_STROKE, RL_CHAIR_STROKE, RL_CHAIR_FILL, RL_CHAIR_TUCK, RL_PREVIEW_HEIGHT, RL_PREVIEW_WIDTH, RL_VIEW_WIDTH, RL_VIEW_HEIGHT, RL_FOOT, RL_AISLEGAP, RL_ROOM_OUTER_SPACING, RL_ROOM_INNER_SPACING, RL_ROOM_STROKE, RL_CORNER_FILL, RL_UNGROUPABLES, RL_CREDIT_TEXT, RL_CREDIT_TEXT_PARAMS };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcHAvaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ2hDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxHQUFHLE1BQU0sQ0FBQztBQUV6RixNQUNFLE9BQU8sR0FBRyxPQUFPLEVBRWpCLFNBQVMsR0FBRyxPQUFPLEVBQ25CLGVBQWUsR0FBRyxPQUFPLEVBQ3pCLGlCQUFpQixHQUFHLEtBQUssRUFFekIsZ0JBQWdCLEdBQUcsR0FBRyxFQUN0QixpQkFBaUIsR0FBRyxHQUFHLEVBRXZCLGVBQWUsR0FBRyxPQUFPLEVBQ3pCLGFBQWEsR0FBRyxRQUFRLEVBRXhCLGFBQWEsR0FBRyxDQUFDLEVBQ2pCLGFBQWEsR0FBRyxHQUFHLEVBQ25CLGNBQWMsR0FBRyxFQUFFLEVBQ25CLE9BQU8sR0FBRyxFQUFFLEVBQ1osV0FBVyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBRXBCLHFCQUFxQixHQUFHLEVBQUUsRUFDMUIscUJBQXFCLEdBQUcsQ0FBQyxFQUN6QixjQUFjLEdBQUcsTUFBTSxFQUN2QixjQUFjLEdBQUcsTUFBTSxFQUN2QixlQUFlLEdBQUcsQ0FBQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxFQUNwRCxjQUFjLEdBQUcsRUFBRSxFQUNuQixxQkFBcUIsR0FBRyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQztBQUd4RixNQUFNLFVBQVUsR0FBRyxDQUFDLFVBQVUsRUFBRSxFQUFFO0lBQ2hDLElBQUksRUFBRSxJQUFJ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QUFRO1FBQ3pCLE1BQU0sRUFBRSxRQUFRO1FBQ2hCLFdBQVcsRUFBRSxFQUFFO1FBQ2YsSUFBSSxFQUFFLFFBQVE7S0FDZixDQUFDLENBQUM7SUFFSCxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDLENBQUM7QUFFRixPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLFdBQVcsRUFDWCxXQUFXLEVBQ1gsVUFBVSxFQUNWLGVBQWUsRUFFZixPQUFPLEVBQ1AsU0FBUyxFQUNULGVBQWUsRUFDZixhQUFhLEVBQ2IsYUFBYSxFQUNiLGlCQUFpQixFQUNqQixnQkFBZ0IsRUFDaEIsYUFBYSxFQUNiLGNBQWMsRUFDZCxPQUFPLEVBQ1AsV0FBVyxFQUNYLHFCQUFxQixFQUNyQixxQkFBcUIsRUFDckIsY0FBYyxFQUNkLGNBQWMsRUFDZCxlQUFlLEVBQ2YsY0FBYyxFQUNkLHFCQUFxQixFQUN0QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZmFicmljIH0gZnJvbSAnZmFicmljJztcclxuY29uc3QgeyBHcm91cCwgUmVjdCwgTGluZSwgQ2lyY2xlLCBFbGxpcHNlLCBQYXRoLCBQb2x5Z29uLCBQb2x5bGluZSwgVHJpYW5nbGUgfSA9IGZhYnJpYztcclxuXHJcbmNvbnN0XHJcbiAgUkxfRklMTCA9ICd3aGl0ZScsXHJcblxyXG4gIFJMX1NUUk9LRSA9ICdncmVlbicsXHJcbiAgUkxfU1RST0tFX0luVXNlID0gJ3llbGxvJyxcclxuICBSTF9TVFJPS0VfTm9SZWFkeSA9ICdyZWQnLFxyXG5cclxuICBSTF9QUkVWSUVXX1dJRFRIID0gMTQwLFxyXG4gIFJMX1BSRVZJRVdfSEVJR0hUID0gMTIwLFxyXG5cclxuICBSTF9DSEFJUl9TVFJPS0UgPSAnd2hpdGUnLFxyXG4gIFJMX0NIQUlSX0ZJTEwgPSAncHVycGxlJyxcclxuXHJcbiAgUkxfQ0hBSVJfVFVDSyA9IDYsXHJcbiAgUkxfVklFV19XSURUSCA9IDEyMCxcclxuICBSTF9WSUVXX0hFSUdIVCA9IDU2LFxyXG4gIFJMX0ZPT1QgPSAxMixcclxuICBSTF9BSVNMRUdBUCA9IDEyICogMyxcclxuXHJcbiAgUkxfUk9PTV9PVVRFUl9TUEFDSU5HID0gNDgsXHJcbiAgUkxfUk9PTV9JTk5FUl9TUEFDSU5HID0gNCxcclxuICBSTF9ST09NX1NUUk9LRSA9ICcjMDAwJyxcclxuICBSTF9DT1JORVJfRklMTCA9ICcjODhmJyxcclxuICBSTF9VTkdST1VQQUJMRVMgPSBbJ0NIQUlSJywgJ01JU0NFTExBTkVPVVMnLCAnRE9PUiddLFxyXG4gIFJMX0NSRURJVF9URVhUID0gJycsXHJcbiAgUkxfQ1JFRElUX1RFWFRfUEFSQU1TID0geyBmb250U2l6ZTogMTIsIGZvbnRGYW1pbHk6ICdBcmlhbCcsIGZpbGw6ICcjOTk5JywgbGVmdDogMTIgfTtcclxuXHJcblxyXG5jb25zdCBjcmVhdGVUZXh0ID0gKHByb3BlcnRpZXMpID0+IHtcclxuICBsZXQgeyB0ZXh0IH0gPSBwcm9wZXJ0aWVzO1xyXG4gIGlmIChwcm9wZXJ0aWVzLmRpcmVjdGlvbiA9PT0gJ1ZFUlRJQ0FMJykge1xyXG4gICAgY29uc3QgY2hhcnMgPSBbXTtcclxuICAgIGZvciAoY29uc3QgY2hhciBvZiB0ZXh0KSB7XHJcbiAgICAgIGNoYXJzLnB1c2goY2hhcik7XHJcbiAgICB9XHJcbiAgICB0ZXh0ID0gY2hhcnMuam9pbignXFxuJyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gbmV3IGZhYnJpYy5JVGV4dCh0ZXh0LCB7XHJcbiAgICBmb250U2l6ZTogcHJvcGVydGllcy5mb250X3NpemUsXHJcbiAgICBsaW5lSGVpZ2h0OiAwLjgsXHJcbiAgICBuYW1lOiBwcm9wZXJ0aWVzLm5hbWUsXHJcbiAgICBoYXNDb250cm9sczogZmFsc2VcclxuICB9KTtcclxufTtcclxuXHJcblxyXG4vKiogQ3JlYXRlIEJhc2ljIFNoYXBlICAqL1xyXG5jb25zdCBjcmVhdGVCYXNpY1NoYXBlID0gKHBhcnQ6IGFueSwgc3Ryb2tlOiBzdHJpbmcgPSAnI2FhYWFhYScsIGZpbGw6IHN0cmluZyA9ICd3aGl0ZScpID0+IHtcclxuICBpZiAocGFydC5kZWZpbml0aW9uLmZpbGwgPT0gbnVsbClcclxuICAgIHBhcnQuZGVmaW5pdGlvbi5maWxsID0gZmlsbDtcclxuXHJcbiAgaWYgKHBhcnQuZGVmaW5pdGlvbi5zdHJva2UgPT0gbnVsbClcclxuICAgIHBhcnQuZGVmaW5pdGlvbi5zdHJva2UgPSBzdHJva2U7XHJcbiAgZWxzZSBpZiAocGFydC5kZWZpbml0aW9uLnN0cm9rZSA9PSAnY2hhaXInKVxyXG4gICAgcGFydC5kZWZpbml0aW9uLnN0cm9rZSA9IFJMX0NIQUlSX1NUUk9LRTtcclxuXHJcbiAgbGV0IGZPYmo7XHJcblxyXG4gIHN3aXRjaCAocGFydC50eXBlKSB7XHJcbiAgICBjYXNlICdjaXJjbGUnOlxyXG4gICAgICBmT2JqID0gbmV3IENpcmNsZShwYXJ0LmRlZmluaXRpb24pO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ2VsbGlwc2UnOlxyXG4gICAgICBmT2JqID0gbmV3IEVsbGlwc2UocGFydC5kZWZpbml0aW9uKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdsaW5lJzpcclxuICAgICAgZk9iaiA9IG5ldyBMaW5lKHBhcnQubGluZSwgcGFydC5kZWZpbml0aW9uKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdwYXRoJzpcclxuICAgICAgZk9iaiA9IG5ldyBQYXRoKHBhcnQucGF0aCwgcGFydC5kZWZpbml0aW9uKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdwb2x5Z29uJzpcclxuICAgICAgZk9iaiA9IG5ldyBQb2x5Z29uKHBhcnQuZGVmaW5pdGlvbik7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAncG9seWxpbmUnOlxyXG4gICAgICBmT2JqID0gbmV3IFBvbHlsaW5lKHBhcnQuZGVmaW5pdGlvbik7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAncmVjdCc6XHJcbiAgICAgIGZPYmogPSBuZXcgUmVjdChwYXJ0LmRlZmluaXRpb24pO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3RyaWFuZ2xlJzpcclxuICAgICAgZk9iaiA9IG5ldyBUcmlhbmdsZShwYXJ0LmRlZmluaXRpb24pO1xyXG4gICAgICBicmVhaztcclxuICB9XHJcblxyXG4gIHJldHVybiAoZk9iaik7XHJcbn07XHJcblxyXG5jb25zdCBjcmVhdGVGdXJuaXR1cmUgPSAodHlwZTogc3RyaW5nLCBvYmplY3QsIGNoYWlyID0ge30pID0+IHtcclxuICBpZiAodHlwZSA9PT0gJ1RBQkxFJykge1xyXG4gICAgLy8gY29uc29sZS5sb2coJ2NoYWlyJywgY2hhaXIpXHJcbiAgICAvLyBjb25zb2xlLmxvZygnb2JqZWN0Jywgb2JqZWN0KVxyXG4gICAgcmV0dXJuIGNyZWF0ZVRhYmxlKG9iamVjdCwgY2hhaXIpO1xyXG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gJ1RFWFQnKSB7XHJcbiAgICByZXR1cm4gY3JlYXRlVGV4dChvYmplY3QpO1xyXG4gIH0gZWxzZSBpZiAodHlwZSA9PT0gJ0xBWU9VVCcpIHtcclxuICAgIHJldHVybiBvYmplY3Q7XHJcbiAgfSBlbHNlIHtcclxuICAgIHJldHVybiBjcmVhdGVTaGFwZShvYmplY3QsIFJMX1NUUk9LRSwgUkxfRklMTCwgdHlwZSk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqIEFkZGluZyBDaGFpcnMgKi9cclxuY29uc3QgY3JlYXRlU2hhcGUgPSAob2JqZWN0OiBhbnksIHN0cm9rZSA9IFJMX0NIQUlSX1NUUk9LRSwgZmlsbCA9IFJMX0NIQUlSX0ZJTEwsIHR5cGU6IHN0cmluZyA9ICdDSEFJUicpOiBmYWJyaWMuR3JvdXAgPT4ge1xyXG4gIGNvbnN0IHBhcnRzID0gb2JqZWN0LnBhcnRzLm1hcChvYmogPT4gY3JlYXRlQmFzaWNTaGFwZShvYmosIHN0cm9rZSwgZmlsbCkpO1xyXG4gIGNvbnN0IGdyb3VwID0gbmV3IEdyb3VwKHBhcnRzLCB7XHJcbiAgICBuYW1lOiBgJHt0eXBlfWAsXHJcbiAgICBoYXNDb250cm9sczogZmFsc2UsXHJcbiAgICBvcmlnaW5YOiAnY2VudGVyJyxcclxuICAgIG9yaWdpblk6ICdjZW50ZXInXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiBncm91cDtcclxufTtcclxuXHJcblxyXG4vLyBBbGwgQ3JlYXRlW05hbWVdT2JqZWN0KCkgZnVuY3Rpb25zIHNob3VsZCByZXR1cm4gYSBncm91cFxyXG5jb25zdCBjcmVhdGVUYWJsZSA9IChkZWY6IGFueSwgUkxfREVGQVVMVF9DSEFJUjogYW55LCB0eXBlOiBzdHJpbmcgPSAnVEFCTEUnKSA9PiB7XHJcbiAgLy8gdGFibGVzIHdpdGggY2hhaXJzIGhhdmUgdGhlIGNoYWlycyBmdWxsLWhlaWdodCBhcm91bmQgdGhlIHRhYmxlXHJcbiAgLy8gY3JlYXRlIHRhYmxlIG5hbWUgcGFzc2luZyBmcm9tIGRlZlxyXG4gIC8vIGNvbnNvbGUubG9nKCdjcmVhdGVUYWJsZSBkZWYnLCBkZWY/Lm5hbWUpXHJcbiAgLy8gY29uc29sZS5sb2coJ2NyZWF0ZVRhYmxlIGRlZiBSTF9ERUZBVUxUX0NIQUlSJywgZGVmPy5uYW1lKVxyXG5cclxuICBjb25zdCBjb21wb25lbnRzID0gW107XHJcbiAgbGV0IGluZGV4ID0gMDtcclxuXHJcbiAgLy8gTm90ZSB0aGF0IHdlJ3JlIHVzaW5nIHRoZSBwcm92aWRlZCB3aWR0aCBhbmQgaGVpZ2h0IGZvciB0YWJsZSBwbGFjZW1lbnRcclxuICAvLyBJc3N1ZXMgbWF5IGFyaXNlIGlmIHJlbmRlcmVkIHNoYXBlIGlzIGxhcmdlci9zbWFsbGVyLCBzaW5jZSBpdCdzIHBvc2l0aW9uZWQgZnJvbSBjZW50ZXIgcG9pbnRcclxuICBjb25zdCBjaGFpcldpZHRoID0gUkxfREVGQVVMVF9DSEFJUi53aWR0aDtcclxuICBjb25zdCBjaGFpckhlaWdodCA9IFJMX0RFRkFVTFRfQ0hBSVIuaGVpZ2h0O1xyXG4gIGNvbnN0IHRhYmxlTGVmdCA9IGRlZi5sZWZ0Q2hhaXJzID4gMCA/IChjaGFpckhlaWdodCAtIFJMX0NIQUlSX1RVQ0spIDogMDtcclxuICBjb25zdCB0YWJsZVRvcCA9IChjaGFpckhlaWdodCAtIFJMX0NIQUlSX1RVQ0spO1xyXG5cclxuICBpZiAoZGVmLnNoYXBlID09ICdjaXJjbGUnKSB7XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luX3ggPSBkZWYud2lkdGggLyAyICsgY2hhaXJIZWlnaHQgLSBSTF9DSEFJUl9UVUNLO1xyXG4gICAgY29uc3Qgb3JpZ2luX3kgPSBkZWYud2lkdGggLyAyICsgY2hhaXJIZWlnaHQgLSBSTF9DSEFJUl9UVUNLO1xyXG4gICAgY29uc3QgeDIgPSBvcmlnaW5feDtcclxuICAgIGNvbnN0IHkyID0gMCArIGNoYWlySGVpZ2h0IC8gMjtcclxuXHJcbiAgICBjb25zdCByb3RhdGlvbl9vcmlnaW4gPSBuZXcgZmFicmljLlBvaW50KG9yaWdpbl94LCBvcmlnaW5feSk7XHJcblxyXG4gICAgY29uc3QgdGFibGVSYWRpdXMgPSBkZWYud2lkdGggLyAyO1xyXG4gICAgY29uc3QgcmFkaXVzID0gZGVmLndpZHRoIC8gMiArIGNoYWlySGVpZ2h0OyAgIC8vIG91dGVyIHJhZGl1cyBvZiB3aG9sZSBzaGFwZSB1bml0XHJcbiAgICBsZXQgYW5nbGUgPSAwO1xyXG4gICAgY29uc3QgYW5nbGVJbmNyZW1lbnQgPSAzNjAgLyAoZGVmLmNoYWlycyA+IDAgPyBkZWYuY2hhaXJzIDogMSk7XHJcblxyXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBkZWYuY2hhaXJzOyArK3gpIHtcclxuICAgICAgLy8gTm90ZSB0aGF0IHdpZHRoIGFuZCBoZWlnaHQgYXJlIHRoZSBzYW1lIGZvciBjaXJjbGUgdGFibGVzXHJcbiAgICAgIC8vIHdpZHRoIG9mIHdob2xlIGFyZWEgd2hlbiBkb25lXHJcbiAgICAgIGNvbnN0IHdpZHRoID0gZGVmLndpZHRoICsgY2hhaXJIZWlnaHQgLSAoUkxfQ0hBSVJfVFVDSyAqIDIpO1xyXG5cclxuICAgICAgY29tcG9uZW50c1tpbmRleF0gPSBjcmVhdGVTaGFwZShSTF9ERUZBVUxUX0NIQUlSLCBSTF9DSEFJUl9TVFJPS0UsIFJMX0NIQUlSX0ZJTEwpO1xyXG5cclxuICAgICAgY29uc3QgYW5nbGVfcmFkaWFucyA9IGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoYW5nbGUpO1xyXG4gICAgICBjb25zdCBlbmQgPSBmYWJyaWMudXRpbC5yb3RhdGVQb2ludChuZXcgZmFicmljLlBvaW50KHgyLCB5MiksIHJvdGF0aW9uX29yaWdpbiwgYW5nbGVfcmFkaWFucyk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmxlZnQgPSBlbmQueDtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gZW5kLnk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmFuZ2xlID0gKGFuZ2xlICsgMTgwID4gMzYwKSA/IChhbmdsZSAtIDE4MCkgOiAoYW5nbGUgKyAxODApO1xyXG4gICAgICBpbmRleCsrO1xyXG4gICAgICBhbmdsZSArPSBhbmdsZUluY3JlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGVmLmZpbGwgID09PSAnJykge1xyXG4gICAgICBkZWYuZmlsbCA9IFJMX0ZJTExcclxuICAgICAgZGVmLnN0cm9rZSA9IFJMX1NUUk9LRVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRhYmxlQ2lyY2xlID0ge1xyXG4gICAgICBsZWZ0OiBvcmlnaW5feCxcclxuICAgICAgdG9wOiBvcmlnaW5feSxcclxuICAgICAgcmFkaXVzOiB0YWJsZVJhZGl1cyxcclxuICAgICAgZmlsbDogZGVmLmZpbGwsXHJcbiAgICAgIHN0cm9rZTogZGVmLnN0cm9rZSxcclxuICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXHJcbiAgICAgIG9yaWdpblk6ICdjZW50ZXInLFxyXG4gICAgICBuYW1lOiBkZWY/Lm5hbWUgKyAnO29yZGVyaWQ7aXRlbU5hbWU7J1xyXG4gICAgfTtcclxuICAgIGNvbXBvbmVudHNbaW5kZXhdID0gbmV3IGZhYnJpYy5DaXJjbGUodGFibGVDaXJjbGUpO1xyXG5cclxuICB9IGVsc2UgaWYgKGRlZi5zaGFwZSA9PSAncmVjdCcpIHtcclxuICAgIGNvbnN0IHRhYmxlUmVjdCA9IHtcclxuICAgICAgd2lkdGg6IGRlZi53aWR0aCxcclxuICAgICAgaGVpZ2h0OiBkZWYuaGVpZ2h0LFxyXG4gICAgICBmaWxsOiBSTF9GSUxMLFxyXG4gICAgICBzdHJva2U6IFJMX1NUUk9LRSxcclxuICAgICAgbmFtZTogZGVmPy5uYW1lICsgJztvcmRlcmlkO2l0ZW1OYW1lOydcclxuICAgIH07XHJcblxyXG4gICAgLy8gY2FsY3VsYXRlIGdhcCBiZXR3ZWVuIGNoYWlycywgd2l0aCBleHRyYSBmb3IgZ2FwIHRvIGVuZCBvZiB0YWJsZVxyXG4gICAgbGV0IGdhcCA9IDAsIGZpcnN0T2Zmc2V0ID0gMCwgbGVmdE9mZnNldCA9IDAsIHRvcE9mZnNldCA9IDA7XHJcblxyXG4gICAgLy8gdG9wIGNoYWlyIHJvd1xyXG4gICAgLy8gTm90ZSB0aGF0IGNoYWlycyAnbG9vayB1cCcgYnkgZGVmYXVsdCwgc28gdGhlIGJvdHRvbSByb3cgaXNuJ3Qgcm90YXRlZFxyXG4gICAgLy8gYW5kIHRoZSB0b3Agcm93IGlzLlxyXG4gICAgZ2FwID0gKGRlZi53aWR0aCAtIChkZWYudG9wQ2hhaXJzICogY2hhaXJXaWR0aCkpIC8gKGRlZi50b3BDaGFpcnMgKyAxKTtcclxuICAgIGZpcnN0T2Zmc2V0ID0gZ2FwICsgdGFibGVMZWZ0O1xyXG4gICAgbGVmdE9mZnNldCA9IGZpcnN0T2Zmc2V0O1xyXG4gICAgdG9wT2Zmc2V0ID0gMDtcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGRlZi50b3BDaGFpcnM7IHgrKykge1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XSA9IGNyZWF0ZVNoYXBlKFJMX0RFRkFVTFRfQ0hBSVIsIFJMX0NIQUlSX1NUUk9LRSwgUkxfQ0hBSVJfRklMTCk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmFuZ2xlID0gLTE4MDtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0ubGVmdCA9IGxlZnRPZmZzZXQgKyBjaGFpcldpZHRoIC8gMjtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gdG9wT2Zmc2V0ICsgY2hhaXJIZWlnaHQgLyAyO1xyXG4gICAgICBpbmRleCsrO1xyXG4gICAgICBsZWZ0T2Zmc2V0ICs9IChjaGFpcldpZHRoICsgZ2FwKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBib3R0b20gY2hhaXIgcm93XHJcbiAgICBnYXAgPSAoZGVmLndpZHRoIC0gKGRlZi5ib3R0b21DaGFpcnMgKiBjaGFpcldpZHRoKSkgLyAoZGVmLmJvdHRvbUNoYWlycyArIDEpO1xyXG4gICAgZmlyc3RPZmZzZXQgPSBnYXAgKyB0YWJsZUxlZnQ7XHJcbiAgICBsZWZ0T2Zmc2V0ID0gZmlyc3RPZmZzZXQ7XHJcbiAgICB0b3BPZmZzZXQgPSB0YWJsZVJlY3QuaGVpZ2h0ICsgY2hhaXJIZWlnaHQgLSAoUkxfQ0hBSVJfVFVDSyAqIDIpO1xyXG5cclxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgZGVmLmJvdHRvbUNoYWlyczsgeCsrKSB7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdID0gY3JlYXRlU2hhcGUoUkxfREVGQVVMVF9DSEFJUiwgUkxfQ0hBSVJfU1RST0tFLCBSTF9DSEFJUl9GSUxMKTtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0ubGVmdCA9IGxlZnRPZmZzZXQgKyBjaGFpcldpZHRoIC8gMjtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gdG9wT2Zmc2V0ICsgY2hhaXJXaWR0aCAvIDI7XHJcbiAgICAgICsraW5kZXg7XHJcbiAgICAgIGxlZnRPZmZzZXQgKz0gKGNoYWlyV2lkdGggKyBnYXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGxlZnQgY2hhaXIgcm93XHJcbiAgICBnYXAgPSAoZGVmLmhlaWdodCAtIChkZWYubGVmdENoYWlycyAqIGNoYWlyV2lkdGgpKSAvIChkZWYubGVmdENoYWlycyArIDEpO1xyXG4gICAgbGVmdE9mZnNldCA9IGNoYWlyV2lkdGggLyAyO1xyXG4gICAgdG9wT2Zmc2V0ID0gdGFibGVUb3AgKyBnYXAgKyBjaGFpcldpZHRoIC8gMjsgIC8vIHRvcCBvZiB0YWJsZSBwbHVzIGZpcnN0IGdhcCwgdGhlbiB0byBjZW50ZXJcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGRlZi5sZWZ0Q2hhaXJzOyB4KyspIHtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0gPSBjcmVhdGVTaGFwZShSTF9ERUZBVUxUX0NIQUlSLCBSTF9DSEFJUl9TVFJPS0UsIFJMX0NIQUlSX0ZJTEwpO1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XS5hbmdsZSA9IDkwO1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XS5sZWZ0ID0gbGVmdE9mZnNldDtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gdG9wT2Zmc2V0O1xyXG4gICAgICArK2luZGV4O1xyXG4gICAgICB0b3BPZmZzZXQgKz0gKGNoYWlyV2lkdGggKyBnYXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHJpZ2h0IGNoYWlyIHJvd1xyXG4gICAgZ2FwID0gKGRlZi5oZWlnaHQgLSAoZGVmLnJpZ2h0Q2hhaXJzICogY2hhaXJXaWR0aCkpIC8gKGRlZi5yaWdodENoYWlycyArIDEpO1xyXG4gICAgbGVmdE9mZnNldCA9IHRhYmxlUmVjdC53aWR0aCArIGNoYWlyV2lkdGggLyAyO1xyXG4gICAgdG9wT2Zmc2V0ID0gdGFibGVUb3AgKyBnYXAgKyBjaGFpcldpZHRoIC8gMjsgIC8vIHRvcCBvZiB0YWJsZSBwbHVzIGZpcnN0IGdhcCwgdGhlbiB0byBjZW50ZXJcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGRlZi5yaWdodENoYWlyczsgeCsrKSB7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdID0gY3JlYXRlU2hhcGUoUkxfREVGQVVMVF9DSEFJUiwgUkxfQ0hBSVJfU1RST0tFLCBSTF9DSEFJUl9GSUxMKTtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0uYW5nbGUgPSAtOTA7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmxlZnQgPSBsZWZ0T2Zmc2V0ICsgY2hhaXJIZWlnaHQgLSAoUkxfQ0hBSVJfVFVDSyAqIDIpO1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XS50b3AgPSB0b3BPZmZzZXQ7XHJcbiAgICAgICsraW5kZXg7XHJcbiAgICAgIHRvcE9mZnNldCArPSAoY2hhaXJXaWR0aCArIGdhcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYWRkIHRhYmxlIG9uIHRvcCBvZiBjaGFpcnNcclxuICAgIGNvbXBvbmVudHNbaW5kZXhdID0gbmV3IGZhYnJpYy5SZWN0KHRhYmxlUmVjdCk7XHJcbiAgICBjb21wb25lbnRzW2luZGV4XS5sZWZ0ID0gdGFibGVMZWZ0O1xyXG4gICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gdGFibGVUb3A7XHJcbiAgfVxyXG5cclxuICBjb25zdCB0YWJsZUdyb3VwID0gbmV3IGZhYnJpYy5Hcm91cChjb21wb25lbnRzLCB7XHJcbiAgICBsZWZ0OiAwLFxyXG4gICAgdG9wOiAwLFxyXG4gICAgaGFzQ29udHJvbHM6IGZhbHNlLFxyXG4gICAgLy8gc2V0IG9yaWdpbiBmb3IgYWxsIGdyb3VwcyB0byBjZW50ZXJcclxuICAgIG9yaWdpblg6ICdjZW50ZXInLFxyXG4gICAgb3JpZ2luWTogJ2NlbnRlcicsXHJcbiAgICBuYW1lOiBkZWY/Lm5hbWUgKyAnO29yZGVyaWQ7aXRlbU5hbWU7JyxcclxuICAgIGJvcmRlckNvbG9yOiAncHVycGxlJyxcclxuICAgIGJhY2tncm91bmRDb2xvcjogJ3B1cnBsZScsXHJcbiAgICBzdHJva2U6ICdwdXJwbGUnLFxyXG4gICAgc3Ryb2tlV2lkdGg6IDEwLFxyXG4gICAgZmlsbDogJ3B1cnBsZSdcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHRhYmxlR3JvdXA7XHJcbn07XHJcblxyXG5leHBvcnQge1xyXG4gIGNyZWF0ZUJhc2ljU2hhcGUsXHJcbiAgY3JlYXRlVGFibGUsXHJcbiAgY3JlYXRlU2hhcGUsXHJcbiAgY3JlYXRlVGV4dCxcclxuICBjcmVhdGVGdXJuaXR1cmUsXHJcblxyXG4gIFJMX0ZJTEwsXHJcbiAgUkxfU1RST0tFLFxyXG4gIFJMX0NIQUlSX1NUUk9LRSxcclxuICBSTF9DSEFJUl9GSUxMLFxyXG4gIFJMX0NIQUlSX1RVQ0ssXHJcbiAgUkxfUFJFVklFV19IRUlHSFQsXHJcbiAgUkxfUFJFVklFV19XSURUSCxcclxuICBSTF9WSUVXX1dJRFRILFxyXG4gIFJMX1ZJRVdfSEVJR0hULFxyXG4gIFJMX0ZPT1QsXHJcbiAgUkxfQUlTTEVHQVAsXHJcbiAgUkxfUk9PTV9PVVRFUl9TUEFDSU5HLFxyXG4gIFJMX1JPT01fSU5ORVJfU1BBQ0lORyxcclxuICBSTF9ST09NX1NUUk9LRSxcclxuICBSTF9DT1JORVJfRklMTCxcclxuICBSTF9VTkdST1VQQUJMRVMsXHJcbiAgUkxfQ1JFRElUX1RFWFQsXHJcbiAgUkxfQ1JFRElUX1RFWFRfUEFSQU1TXHJcbn07XHJcbiJdfQ==