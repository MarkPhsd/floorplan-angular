import { fabric } from 'fabric';
const { Group, Rect, Line, Circle, Ellipse, Path, Polygon, Polyline, Triangle } = fabric;
const RL_FILL = 'white', RL_STROKE = 'green', RL_STROKE_InUse = 'yello', RL_STROKE_NoReady = 'red', RL_PREVIEW_WIDTH = 140, RL_PREVIEW_HEIGHT = 120, RL_CHAIR_STROKE = 'white', RL_CHAIR_FILL = 'purple', RL_CHAIR_TUCK = 6, RL_VIEW_WIDTH = 120, RL_VIEW_HEIGHT = 56, RL_FOOT = 12, RL_AISLEGAP = 12 * 3, RL_ROOM_OUTER_SPACING = 48, RL_ROOM_INNER_SPACING = 4, RL_ROOM_STROKE = '#000', RL_CORNER_FILL = '#88f', RL_UNGROUPABLES = ['CHAIR', 'MISCELLANEOUS', 'DOOR'], RL_CREDIT_TEXT = '', RL_CREDIT_TEXT_PARAMS = { fontSize: 12, fontFamily: 'Arial', fill: '#999', left: 12 };
const createText = (properties) => {
    let { text } = properties;
    if (properties.direction === 'VERTICAL') {
        const chars = [];
        for (const char of text) {
            chars.push(char);
        }
        text = chars.join('\n');
    }
    return new fabric.IText(text, {
        fontSize: properties.font_size,
        lineHeight: 0.8,
        name: properties.name,
        hasControls: false
    });
};
/** Create Basic Shape  */
const createBasicShape = (part, stroke = '#aaaaaa', fill = 'white') => {
    if (part.definition.fill == null)
        part.definition.fill = fill;
    if (part.definition.stroke == null)
        part.definition.stroke = stroke;
    else if (part.definition.stroke == 'chair')
        part.definition.stroke = RL_CHAIR_STROKE;
    let fObj;
    switch (part.type) {
        case 'circle':
            fObj = new Circle(part.definition);
            break;
        case 'ellipse':
            fObj = new Ellipse(part.definition);
            break;
        case 'line':
            fObj = new Line(part.line, part.definition);
            break;
        case 'path':
            fObj = new Path(part.path, part.definition);
            break;
        case 'polygon':
            fObj = new Polygon(part.definition);
            break;
        case 'polyline':
            fObj = new Polyline(part.definition);
            break;
        case 'rect':
            fObj = new Rect(part.definition);
            break;
        case 'triangle':
            fObj = new Triangle(part.definition);
            break;
    }
    return (fObj);
};
const createFurniture = (type, object, chair = {}) => {
    if (type === 'TABLE') {
        console.log('chair', chair);
        console.log('object', object);
        return createTable(object, chair);
    }
    else if (type === 'TEXT') {
        return createText(object);
    }
    else if (type === 'LAYOUT') {
        return object;
    }
    else {
        return createShape(object, RL_STROKE, RL_FILL, type);
    }
};
/** Adding Chairs */
const createShape = (object, stroke = RL_CHAIR_STROKE, fill = RL_CHAIR_FILL, type = 'CHAIR') => {
    const parts = object.parts.map(obj => createBasicShape(obj, stroke, fill));
    const group = new Group(parts, {
        name: `${type}:${object.title}`,
        hasControls: false,
        originX: 'center',
        originY: 'center'
    });
    return group;
};
// All Create[Name]Object() functions should return a group
const createTable = (def, RL_DEFAULT_CHAIR, type = 'TABLE') => {
    // tables with chairs have the chairs full-height around the table
    // create table name passing from def
    // console.log('createTable def', def?.name)
    // console.log('createTable def RL_DEFAULT_CHAIR', def?.name)
    const components = [];
    let index = 0;
    // Note that we're using the provided width and height for table placement
    // Issues may arise if rendered shape is larger/smaller, since it's positioned from center point
    const chairWidth = RL_DEFAULT_CHAIR.width;
    const chairHeight = RL_DEFAULT_CHAIR.height;
    const tableLeft = def.leftChairs > 0 ? (chairHeight - RL_CHAIR_TUCK) : 0;
    const tableTop = (chairHeight - RL_CHAIR_TUCK);
    if (def.shape == 'circle') {
        const origin_x = def.width / 2 + chairHeight - RL_CHAIR_TUCK;
        const origin_y = def.width / 2 + chairHeight - RL_CHAIR_TUCK;
        const x2 = origin_x;
        const y2 = 0 + chairHeight / 2;
        const rotation_origin = new fabric.Point(origin_x, origin_y);
        const tableRadius = def.width / 2;
        const radius = def.width / 2 + chairHeight; // outer radius of whole shape unit
        let angle = 0;
        const angleIncrement = 360 / (def.chairs > 0 ? def.chairs : 1);
        for (let x = 0; x < def.chairs; ++x) {
            // Note that width and height are the same for circle tables
            // width of whole area when done
            const width = def.width + chairHeight - (RL_CHAIR_TUCK * 2);
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            const angle_radians = fabric.util.degreesToRadians(angle);
            const end = fabric.util.rotatePoint(new fabric.Point(x2, y2), rotation_origin, angle_radians);
            components[index].left = end.x;
            components[index].top = end.y;
            components[index].angle = (angle + 180 > 360) ? (angle - 180) : (angle + 180);
            index++;
            angle += angleIncrement;
        }
        if (def.fill === '') {
            def.fill = RL_FILL;
            def.stroke = RL_STROKE;
        }
        const tableCircle = {
            left: origin_x,
            top: origin_y,
            radius: tableRadius,
            fill: def.fill,
            stroke: def.stroke,
            originX: 'center',
            originY: 'center',
            name: def?.name + ';orderid;itemName;'
        };
        components[index] = new fabric.Circle(tableCircle);
    }
    else if (def.shape == 'rect') {
        const tableRect = {
            width: def.width,
            height: def.height,
            fill: RL_FILL,
            stroke: RL_STROKE,
            name: def?.name + ';orderid;itemName;'
        };
        // calculate gap between chairs, with extra for gap to end of table
        let gap = 0, firstOffset = 0, leftOffset = 0, topOffset = 0;
        // top chair row
        // Note that chairs 'look up' by default, so the bottom row isn't rotated
        // and the top row is.
        gap = (def.width - (def.topChairs * chairWidth)) / (def.topChairs + 1);
        firstOffset = gap + tableLeft;
        leftOffset = firstOffset;
        topOffset = 0;
        for (let x = 0; x < def.topChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].angle = -180;
            components[index].left = leftOffset + chairWidth / 2;
            components[index].top = topOffset + chairHeight / 2;
            index++;
            leftOffset += (chairWidth + gap);
        }
        // bottom chair row
        gap = (def.width - (def.bottomChairs * chairWidth)) / (def.bottomChairs + 1);
        firstOffset = gap + tableLeft;
        leftOffset = firstOffset;
        topOffset = tableRect.height + chairHeight - (RL_CHAIR_TUCK * 2);
        for (let x = 0; x < def.bottomChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].left = leftOffset + chairWidth / 2;
            components[index].top = topOffset + chairWidth / 2;
            ++index;
            leftOffset += (chairWidth + gap);
        }
        // left chair row
        gap = (def.height - (def.leftChairs * chairWidth)) / (def.leftChairs + 1);
        leftOffset = chairWidth / 2;
        topOffset = tableTop + gap + chairWidth / 2; // top of table plus first gap, then to center
        for (let x = 0; x < def.leftChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].angle = 90;
            components[index].left = leftOffset;
            components[index].top = topOffset;
            ++index;
            topOffset += (chairWidth + gap);
        }
        // right chair row
        gap = (def.height - (def.rightChairs * chairWidth)) / (def.rightChairs + 1);
        leftOffset = tableRect.width + chairWidth / 2;
        topOffset = tableTop + gap + chairWidth / 2; // top of table plus first gap, then to center
        for (let x = 0; x < def.rightChairs; x++) {
            components[index] = createShape(RL_DEFAULT_CHAIR, RL_CHAIR_STROKE, RL_CHAIR_FILL);
            components[index].angle = -90;
            components[index].left = leftOffset + chairHeight - (RL_CHAIR_TUCK * 2);
            components[index].top = topOffset;
            ++index;
            topOffset += (chairWidth + gap);
        }
        // add table on top of chairs
        components[index] = new fabric.Rect(tableRect);
        components[index].left = tableLeft;
        components[index].top = tableTop;
    }
    const tableGroup = new fabric.Group(components, {
        left: 0,
        top: 0,
        hasControls: false,
        // set origin for all groups to center
        originX: 'center',
        originY: 'center',
        name: def?.name + ';orderid;itemName;',
        borderColor: 'purple',
        backgroundColor: 'purple',
        stroke: 'purple',
        strokeWidth: 10,
        fill: 'purple'
    });
    return tableGroup;
};
export { createBasicShape, createTable, createShape, createText, createFurniture, RL_FILL, RL_STROKE, RL_CHAIR_STROKE, RL_CHAIR_FILL, RL_CHAIR_TUCK, RL_PREVIEW_HEIGHT, RL_PREVIEW_WIDTH, RL_VIEW_WIDTH, RL_VIEW_HEIGHT, RL_FOOT, RL_AISLEGAP, RL_ROOM_OUTER_SPACING, RL_ROOM_INNER_SPACING, RL_ROOM_STROKE, RL_CORNER_FILL, RL_UNGROUPABLES, RL_CREDIT_TEXT, RL_CREDIT_TEXT_PARAMS };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9hcHAvaGVscGVycy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ2hDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLFFBQVEsRUFBRSxHQUFHLE1BQU0sQ0FBQztBQUV6RixNQUNFLE9BQU8sR0FBRyxPQUFPLEVBRWpCLFNBQVMsR0FBRyxPQUFPLEVBQ25CLGVBQWUsR0FBRyxPQUFPLEVBQ3pCLGlCQUFpQixHQUFHLEtBQUssRUFFekIsZ0JBQWdCLEdBQUcsR0FBRyxFQUN0QixpQkFBaUIsR0FBRyxHQUFHLEVBRXZCLGVBQWUsR0FBRyxPQUFPLEVBQ3pCLGFBQWEsR0FBRyxRQUFRLEVBRXhCLGFBQWEsR0FBRyxDQUFDLEVBQ2pCLGFBQWEsR0FBRyxHQUFHLEVBQ25CLGNBQWMsR0FBRyxFQUFFLEVBQ25CLE9BQU8sR0FBRyxFQUFFLEVBQ1osV0FBVyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBRXBCLHFCQUFxQixHQUFHLEVBQUUsRUFDMUIscUJBQXFCLEdBQUcsQ0FBQyxFQUN6QixjQUFjLEdBQUcsTUFBTSxFQUN2QixjQUFjLEdBQUcsTUFBTSxFQUN2QixlQUFlLEdBQUcsQ0FBQyxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sQ0FBQyxFQUNwRCxjQUFjLEdBQUcsRUFBRSxFQUNuQixxQkFBcUIsR0FBRyxFQUFFLFFBQVEsRUFBRSxFQUFFLEVBQUUsVUFBVSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsQ0FBQztBQUd4RixNQUFNLFVBQVUsR0FBRyxDQUFDLFVBQVUsRUFBRSxFQUFFO0lBQ2hDLElBQUksRUFBRSxJQUFJ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LE9BQU8sRUFBRSxRQUFRO1FBQ2pCLElBQUksRUFBRSxHQUFHLEVBQUUsSUFBSSxHQUFHLG9CQUFvQjtRQUN0QyxXQUFXLEVBQUUsUUFBUTtRQUNyQixlQUFlLEVBQUUsUUFBUTtRQUN6QixNQUFNLEVBQUUsUUFBUTtRQUNoQixXQUFXLEVBQUUsRUFBRTtRQUNmLElBQUksRUFBRSxRQUFRO0tBQ2YsQ0FBQyxDQUFDO0lBRUgsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQyxDQUFDO0FBRUYsT0FBTyxFQUNMLGdCQUFnQixFQUNoQixXQUFXLEVBQ1gsV0FBVyxFQUNYLFVBQVUsRUFDVixlQUFlLEVBRWYsT0FBTyxFQUNQLFNBQVMsRUFDVCxlQUFlLEVBQ2YsYUFBYSxFQUNiLGFBQWEsRUFDYixpQkFBaUIsRUFDakIsZ0JBQWdCLEVBQ2hCLGFBQWEsRUFDYixjQUFjLEVBQ2QsT0FBTyxFQUNQLFdBQVcsRUFDWCxxQkFBcUIsRUFDckIscUJBQXFCLEVBQ3JCLGNBQWMsRUFDZCxjQUFjLEVBQ2QsZUFBZSxFQUNmLGNBQWMsRUFDZCxxQkFBcUIsRUFDdEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGZhYnJpYyB9IGZyb20gJ2ZhYnJpYyc7XHJcbmNvbnN0IHsgR3JvdXAsIFJlY3QsIExpbmUsIENpcmNsZSwgRWxsaXBzZSwgUGF0aCwgUG9seWdvbiwgUG9seWxpbmUsIFRyaWFuZ2xlIH0gPSBmYWJyaWM7XHJcblxyXG5jb25zdFxyXG4gIFJMX0ZJTEwgPSAnd2hpdGUnLFxyXG5cclxuICBSTF9TVFJPS0UgPSAnZ3JlZW4nLFxyXG4gIFJMX1NUUk9LRV9JblVzZSA9ICd5ZWxsbycsXHJcbiAgUkxfU1RST0tFX05vUmVhZHkgPSAncmVkJyxcclxuXHJcbiAgUkxfUFJFVklFV19XSURUSCA9IDE0MCxcclxuICBSTF9QUkVWSUVXX0hFSUdIVCA9IDEyMCxcclxuXHJcbiAgUkxfQ0hBSVJfU1RST0tFID0gJ3doaXRlJyxcclxuICBSTF9DSEFJUl9GSUxMID0gJ3B1cnBsZScsXHJcblxyXG4gIFJMX0NIQUlSX1RVQ0sgPSA2LFxyXG4gIFJMX1ZJRVdfV0lEVEggPSAxMjAsXHJcbiAgUkxfVklFV19IRUlHSFQgPSA1NixcclxuICBSTF9GT09UID0gMTIsXHJcbiAgUkxfQUlTTEVHQVAgPSAxMiAqIDMsXHJcblxyXG4gIFJMX1JPT01fT1VURVJfU1BBQ0lORyA9IDQ4LFxyXG4gIFJMX1JPT01fSU5ORVJfU1BBQ0lORyA9IDQsXHJcbiAgUkxfUk9PTV9TVFJPS0UgPSAnIzAwMCcsXHJcbiAgUkxfQ09STkVSX0ZJTEwgPSAnIzg4ZicsXHJcbiAgUkxfVU5HUk9VUEFCTEVTID0gWydDSEFJUicsICdNSVNDRUxMQU5FT1VTJywgJ0RPT1InXSxcclxuICBSTF9DUkVESVRfVEVYVCA9ICcnLFxyXG4gIFJMX0NSRURJVF9URVhUX1BBUkFNUyA9IHsgZm9udFNpemU6IDEyLCBmb250RmFtaWx5OiAnQXJpYWwnLCBmaWxsOiAnIzk5OScsIGxlZnQ6IDEyIH07XHJcblxyXG5cclxuY29uc3QgY3JlYXRlVGV4dCA9IChwcm9wZXJ0aWVzKSA9PiB7XHJcbiAgbGV0IHsgdGV4dCB9ID0gcHJvcGVydGllcztcclxuICBpZiAocHJvcGVydGllcy5kaXJlY3Rpb24gPT09ICdWRVJUSUNBTCcpIHtcclxuICAgIGNvbnN0IGNoYXJzID0gW107XHJcbiAgICBmb3IgKGNvbnN0IGNoYXIgb2YgdGV4dCkge1xyXG4gICAgICBjaGFycy5wdXNoKGNoYXIpO1xyXG4gICAgfVxyXG4gICAgdGV4dCA9IGNoYXJzLmpvaW4oJ1xcbicpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIG5ldyBmYWJyaWMuSVRleHQodGV4dCwge1xyXG4gICAgZm9udFNpemU6IHByb3BlcnRpZXMuZm9udF9zaXplLFxyXG4gICAgbGluZUhlaWdodDogMC44LFxyXG4gICAgbmFtZTogcHJvcGVydGllcy5uYW1lLFxyXG4gICAgaGFzQ29udHJvbHM6IGZhbHNlXHJcbiAgfSk7XHJcbn07XHJcblxyXG5cclxuLyoqIENyZWF0ZSBCYXNpYyBTaGFwZSAgKi9cclxuY29uc3QgY3JlYXRlQmFzaWNTaGFwZSA9IChwYXJ0OiBhbnksIHN0cm9rZTogc3RyaW5nID0gJyNhYWFhYWEnLCBmaWxsOiBzdHJpbmcgPSAnd2hpdGUnKSA9PiB7XHJcbiAgaWYgKHBhcnQuZGVmaW5pdGlvbi5maWxsID09IG51bGwpXHJcbiAgICBwYXJ0LmRlZmluaXRpb24uZmlsbCA9IGZpbGw7XHJcblxyXG4gIGlmIChwYXJ0LmRlZmluaXRpb24uc3Ryb2tlID09IG51bGwpXHJcbiAgICBwYXJ0LmRlZmluaXRpb24uc3Ryb2tlID0gc3Ryb2tlO1xyXG4gIGVsc2UgaWYgKHBhcnQuZGVmaW5pdGlvbi5zdHJva2UgPT0gJ2NoYWlyJylcclxuICAgIHBhcnQuZGVmaW5pdGlvbi5zdHJva2UgPSBSTF9DSEFJUl9TVFJPS0U7XHJcblxyXG4gIGxldCBmT2JqO1xyXG5cclxuICBzd2l0Y2ggKHBhcnQudHlwZSkge1xyXG4gICAgY2FzZSAnY2lyY2xlJzpcclxuICAgICAgZk9iaiA9IG5ldyBDaXJjbGUocGFydC5kZWZpbml0aW9uKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICdlbGxpcHNlJzpcclxuICAgICAgZk9iaiA9IG5ldyBFbGxpcHNlKHBhcnQuZGVmaW5pdGlvbik7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAnbGluZSc6XHJcbiAgICAgIGZPYmogPSBuZXcgTGluZShwYXJ0LmxpbmUsIHBhcnQuZGVmaW5pdGlvbik7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAncGF0aCc6XHJcbiAgICAgIGZPYmogPSBuZXcgUGF0aChwYXJ0LnBhdGgsIHBhcnQuZGVmaW5pdGlvbik7XHJcbiAgICAgIGJyZWFrO1xyXG4gICAgY2FzZSAncG9seWdvbic6XHJcbiAgICAgIGZPYmogPSBuZXcgUG9seWdvbihwYXJ0LmRlZmluaXRpb24pO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3BvbHlsaW5lJzpcclxuICAgICAgZk9iaiA9IG5ldyBQb2x5bGluZShwYXJ0LmRlZmluaXRpb24pO1xyXG4gICAgICBicmVhaztcclxuICAgIGNhc2UgJ3JlY3QnOlxyXG4gICAgICBmT2JqID0gbmV3IFJlY3QocGFydC5kZWZpbml0aW9uKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlICd0cmlhbmdsZSc6XHJcbiAgICAgIGZPYmogPSBuZXcgVHJpYW5nbGUocGFydC5kZWZpbml0aW9uKTtcclxuICAgICAgYnJlYWs7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gKGZPYmopO1xyXG59O1xyXG5cclxuY29uc3QgY3JlYXRlRnVybml0dXJlID0gKHR5cGU6IHN0cmluZywgb2JqZWN0LCBjaGFpciA9IHt9KSA9PiB7XHJcbiAgaWYgKHR5cGUgPT09ICdUQUJMRScpIHtcclxuICAgIGNvbnNvbGUubG9nKCdjaGFpcicsIGNoYWlyKVxyXG4gICAgY29uc29sZS5sb2coJ29iamVjdCcsIG9iamVjdClcclxuICAgIHJldHVybiBjcmVhdGVUYWJsZShvYmplY3QsIGNoYWlyKTtcclxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdURVhUJykge1xyXG4gICAgcmV0dXJuIGNyZWF0ZVRleHQob2JqZWN0KTtcclxuICB9IGVsc2UgaWYgKHR5cGUgPT09ICdMQVlPVVQnKSB7XHJcbiAgICByZXR1cm4gb2JqZWN0O1xyXG4gIH0gZWxzZSB7XHJcbiAgICByZXR1cm4gY3JlYXRlU2hhcGUob2JqZWN0LCBSTF9TVFJPS0UsIFJMX0ZJTEwsIHR5cGUpO1xyXG4gIH1cclxufTtcclxuXHJcbi8qKiBBZGRpbmcgQ2hhaXJzICovXHJcbmNvbnN0IGNyZWF0ZVNoYXBlID0gKG9iamVjdDogYW55LCBzdHJva2UgPSBSTF9DSEFJUl9TVFJPS0UsIGZpbGwgPSBSTF9DSEFJUl9GSUxMLCB0eXBlOiBzdHJpbmcgPSAnQ0hBSVInKTogZmFicmljLkdyb3VwID0+IHtcclxuICBjb25zdCBwYXJ0cyA9IG9iamVjdC5wYXJ0cy5tYXAob2JqID0+IGNyZWF0ZUJhc2ljU2hhcGUob2JqLCBzdHJva2UsIGZpbGwpKTtcclxuICBjb25zdCBncm91cCA9IG5ldyBHcm91cChwYXJ0cywge1xyXG4gICAgbmFtZTogYCR7dHlwZX06JHtvYmplY3QudGl0bGV9YCxcclxuICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcclxuICAgIG9yaWdpblg6ICdjZW50ZXInLFxyXG4gICAgb3JpZ2luWTogJ2NlbnRlcidcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIGdyb3VwO1xyXG59O1xyXG5cclxuXHJcbi8vIEFsbCBDcmVhdGVbTmFtZV1PYmplY3QoKSBmdW5jdGlvbnMgc2hvdWxkIHJldHVybiBhIGdyb3VwXHJcblxyXG5jb25zdCBjcmVhdGVUYWJsZSA9IChkZWY6IGFueSwgUkxfREVGQVVMVF9DSEFJUjogYW55LCB0eXBlOiBzdHJpbmcgPSAnVEFCTEUnKSA9PiB7XHJcbiAgLy8gdGFibGVzIHdpdGggY2hhaXJzIGhhdmUgdGhlIGNoYWlycyBmdWxsLWhlaWdodCBhcm91bmQgdGhlIHRhYmxlXHJcbiAgLy8gY3JlYXRlIHRhYmxlIG5hbWUgcGFzc2luZyBmcm9tIGRlZlxyXG4gIC8vIGNvbnNvbGUubG9nKCdjcmVhdGVUYWJsZSBkZWYnLCBkZWY/Lm5hbWUpXHJcbiAgLy8gY29uc29sZS5sb2coJ2NyZWF0ZVRhYmxlIGRlZiBSTF9ERUZBVUxUX0NIQUlSJywgZGVmPy5uYW1lKVxyXG5cclxuICBjb25zdCBjb21wb25lbnRzID0gW107XHJcbiAgbGV0IGluZGV4ID0gMDtcclxuXHJcbiAgLy8gTm90ZSB0aGF0IHdlJ3JlIHVzaW5nIHRoZSBwcm92aWRlZCB3aWR0aCBhbmQgaGVpZ2h0IGZvciB0YWJsZSBwbGFjZW1lbnRcclxuICAvLyBJc3N1ZXMgbWF5IGFyaXNlIGlmIHJlbmRlcmVkIHNoYXBlIGlzIGxhcmdlci9zbWFsbGVyLCBzaW5jZSBpdCdzIHBvc2l0aW9uZWQgZnJvbSBjZW50ZXIgcG9pbnRcclxuICBjb25zdCBjaGFpcldpZHRoID0gUkxfREVGQVVMVF9DSEFJUi53aWR0aDtcclxuICBjb25zdCBjaGFpckhlaWdodCA9IFJMX0RFRkFVTFRfQ0hBSVIuaGVpZ2h0O1xyXG4gIGNvbnN0IHRhYmxlTGVmdCA9IGRlZi5sZWZ0Q2hhaXJzID4gMCA/IChjaGFpckhlaWdodCAtIFJMX0NIQUlSX1RVQ0spIDogMDtcclxuICBjb25zdCB0YWJsZVRvcCA9IChjaGFpckhlaWdodCAtIFJMX0NIQUlSX1RVQ0spO1xyXG5cclxuICBpZiAoZGVmLnNoYXBlID09ICdjaXJjbGUnKSB7XHJcblxyXG4gICAgY29uc3Qgb3JpZ2luX3ggPSBkZWYud2lkdGggLyAyICsgY2hhaXJIZWlnaHQgLSBSTF9DSEFJUl9UVUNLO1xyXG4gICAgY29uc3Qgb3JpZ2luX3kgPSBkZWYud2lkdGggLyAyICsgY2hhaXJIZWlnaHQgLSBSTF9DSEFJUl9UVUNLO1xyXG4gICAgY29uc3QgeDIgPSBvcmlnaW5feDtcclxuICAgIGNvbnN0IHkyID0gMCArIGNoYWlySGVpZ2h0IC8gMjtcclxuXHJcbiAgICBjb25zdCByb3RhdGlvbl9vcmlnaW4gPSBuZXcgZmFicmljLlBvaW50KG9yaWdpbl94LCBvcmlnaW5feSk7XHJcblxyXG4gICAgY29uc3QgdGFibGVSYWRpdXMgPSBkZWYud2lkdGggLyAyO1xyXG4gICAgY29uc3QgcmFkaXVzID0gZGVmLndpZHRoIC8gMiArIGNoYWlySGVpZ2h0OyAgIC8vIG91dGVyIHJhZGl1cyBvZiB3aG9sZSBzaGFwZSB1bml0XHJcbiAgICBsZXQgYW5nbGUgPSAwO1xyXG4gICAgY29uc3QgYW5nbGVJbmNyZW1lbnQgPSAzNjAgLyAoZGVmLmNoYWlycyA+IDAgPyBkZWYuY2hhaXJzIDogMSk7XHJcblxyXG4gICAgZm9yIChsZXQgeCA9IDA7IHggPCBkZWYuY2hhaXJzOyArK3gpIHtcclxuICAgICAgLy8gTm90ZSB0aGF0IHdpZHRoIGFuZCBoZWlnaHQgYXJlIHRoZSBzYW1lIGZvciBjaXJjbGUgdGFibGVzXHJcbiAgICAgIC8vIHdpZHRoIG9mIHdob2xlIGFyZWEgd2hlbiBkb25lXHJcbiAgICAgIGNvbnN0IHdpZHRoID0gZGVmLndpZHRoICsgY2hhaXJIZWlnaHQgLSAoUkxfQ0hBSVJfVFVDSyAqIDIpO1xyXG5cclxuICAgICAgY29tcG9uZW50c1tpbmRleF0gPSBjcmVhdGVTaGFwZShSTF9ERUZBVUxUX0NIQUlSLCBSTF9DSEFJUl9TVFJPS0UsIFJMX0NIQUlSX0ZJTEwpO1xyXG5cclxuICAgICAgY29uc3QgYW5nbGVfcmFkaWFucyA9IGZhYnJpYy51dGlsLmRlZ3JlZXNUb1JhZGlhbnMoYW5nbGUpO1xyXG4gICAgICBjb25zdCBlbmQgPSBmYWJyaWMudXRpbC5yb3RhdGVQb2ludChuZXcgZmFicmljLlBvaW50KHgyLCB5MiksIHJvdGF0aW9uX29yaWdpbiwgYW5nbGVfcmFkaWFucyk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmxlZnQgPSBlbmQueDtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gZW5kLnk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmFuZ2xlID0gKGFuZ2xlICsgMTgwID4gMzYwKSA/IChhbmdsZSAtIDE4MCkgOiAoYW5nbGUgKyAxODApO1xyXG4gICAgICBpbmRleCsrO1xyXG4gICAgICBhbmdsZSArPSBhbmdsZUluY3JlbWVudDtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoZGVmLmZpbGwgID09PSAnJykge1xyXG4gICAgICBkZWYuZmlsbCA9IFJMX0ZJTExcclxuICAgICAgZGVmLnN0cm9rZSA9IFJMX1NUUk9LRVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHRhYmxlQ2lyY2xlID0ge1xyXG4gICAgICBsZWZ0OiBvcmlnaW5feCxcclxuICAgICAgdG9wOiBvcmlnaW5feSxcclxuICAgICAgcmFkaXVzOiB0YWJsZVJhZGl1cyxcclxuICAgICAgZmlsbDogZGVmLmZpbGwsXHJcbiAgICAgIHN0cm9rZTogZGVmLnN0cm9rZSxcclxuICAgICAgb3JpZ2luWDogJ2NlbnRlcicsXHJcbiAgICAgIG9yaWdpblk6ICdjZW50ZXInLFxyXG4gICAgICBuYW1lOiBkZWY/Lm5hbWUgKyAnO29yZGVyaWQ7aXRlbU5hbWU7J1xyXG4gICAgfTtcclxuICAgIGNvbXBvbmVudHNbaW5kZXhdID0gbmV3IGZhYnJpYy5DaXJjbGUodGFibGVDaXJjbGUpO1xyXG5cclxuICB9IGVsc2UgaWYgKGRlZi5zaGFwZSA9PSAncmVjdCcpIHtcclxuICAgIGNvbnN0IHRhYmxlUmVjdCA9IHtcclxuICAgICAgd2lkdGg6IGRlZi53aWR0aCxcclxuICAgICAgaGVpZ2h0OiBkZWYuaGVpZ2h0LFxyXG4gICAgICBmaWxsOiBSTF9GSUxMLFxyXG4gICAgICBzdHJva2U6IFJMX1NUUk9LRSxcclxuICAgICAgbmFtZTogZGVmPy5uYW1lICsgJztvcmRlcmlkO2l0ZW1OYW1lOydcclxuICAgIH07XHJcblxyXG4gICAgLy8gY2FsY3VsYXRlIGdhcCBiZXR3ZWVuIGNoYWlycywgd2l0aCBleHRyYSBmb3IgZ2FwIHRvIGVuZCBvZiB0YWJsZVxyXG4gICAgbGV0IGdhcCA9IDAsIGZpcnN0T2Zmc2V0ID0gMCwgbGVmdE9mZnNldCA9IDAsIHRvcE9mZnNldCA9IDA7XHJcblxyXG4gICAgLy8gdG9wIGNoYWlyIHJvd1xyXG4gICAgLy8gTm90ZSB0aGF0IGNoYWlycyAnbG9vayB1cCcgYnkgZGVmYXVsdCwgc28gdGhlIGJvdHRvbSByb3cgaXNuJ3Qgcm90YXRlZFxyXG4gICAgLy8gYW5kIHRoZSB0b3Agcm93IGlzLlxyXG4gICAgZ2FwID0gKGRlZi53aWR0aCAtIChkZWYudG9wQ2hhaXJzICogY2hhaXJXaWR0aCkpIC8gKGRlZi50b3BDaGFpcnMgKyAxKTtcclxuICAgIGZpcnN0T2Zmc2V0ID0gZ2FwICsgdGFibGVMZWZ0O1xyXG4gICAgbGVmdE9mZnNldCA9IGZpcnN0T2Zmc2V0O1xyXG4gICAgdG9wT2Zmc2V0ID0gMDtcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGRlZi50b3BDaGFpcnM7IHgrKykge1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XSA9IGNyZWF0ZVNoYXBlKFJMX0RFRkFVTFRfQ0hBSVIsIFJMX0NIQUlSX1NUUk9LRSwgUkxfQ0hBSVJfRklMTCk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmFuZ2xlID0gLTE4MDtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0ubGVmdCA9IGxlZnRPZmZzZXQgKyBjaGFpcldpZHRoIC8gMjtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0udG9wID0gdG9wT2Zmc2V0ICsgY2hhaXJIZWlnaHQgLyAyO1xyXG4gICAgICBpbmRleCsrO1xyXG5cclxuICAgICAgbGVmdE9mZnNldCArPSAoY2hhaXJXaWR0aCArIGdhcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gYm90dG9tIGNoYWlyIHJvd1xyXG4gICAgZ2FwID0gKGRlZi53aWR0aCAtIChkZWYuYm90dG9tQ2hhaXJzICogY2hhaXJXaWR0aCkpIC8gKGRlZi5ib3R0b21DaGFpcnMgKyAxKTtcclxuICAgIGZpcnN0T2Zmc2V0ID0gZ2FwICsgdGFibGVMZWZ0O1xyXG4gICAgbGVmdE9mZnNldCA9IGZpcnN0T2Zmc2V0O1xyXG4gICAgdG9wT2Zmc2V0ID0gdGFibGVSZWN0LmhlaWdodCArIGNoYWlySGVpZ2h0IC0gKFJMX0NIQUlSX1RVQ0sgKiAyKTtcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGRlZi5ib3R0b21DaGFpcnM7IHgrKykge1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XSA9IGNyZWF0ZVNoYXBlKFJMX0RFRkFVTFRfQ0hBSVIsIFJMX0NIQUlSX1NUUk9LRSwgUkxfQ0hBSVJfRklMTCk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmxlZnQgPSBsZWZ0T2Zmc2V0ICsgY2hhaXJXaWR0aCAvIDI7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLnRvcCA9IHRvcE9mZnNldCArIGNoYWlyV2lkdGggLyAyO1xyXG4gICAgICArK2luZGV4O1xyXG5cclxuICAgICAgbGVmdE9mZnNldCArPSAoY2hhaXJXaWR0aCArIGdhcCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gbGVmdCBjaGFpciByb3dcclxuICAgIGdhcCA9IChkZWYuaGVpZ2h0IC0gKGRlZi5sZWZ0Q2hhaXJzICogY2hhaXJXaWR0aCkpIC8gKGRlZi5sZWZ0Q2hhaXJzICsgMSk7XHJcbiAgICBsZWZ0T2Zmc2V0ID0gY2hhaXJXaWR0aCAvIDI7XHJcbiAgICB0b3BPZmZzZXQgPSB0YWJsZVRvcCArIGdhcCArIGNoYWlyV2lkdGggLyAyOyAgLy8gdG9wIG9mIHRhYmxlIHBsdXMgZmlyc3QgZ2FwLCB0aGVuIHRvIGNlbnRlclxyXG5cclxuICAgIGZvciAobGV0IHggPSAwOyB4IDwgZGVmLmxlZnRDaGFpcnM7IHgrKykge1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XSA9IGNyZWF0ZVNoYXBlKFJMX0RFRkFVTFRfQ0hBSVIsIFJMX0NIQUlSX1NUUk9LRSwgUkxfQ0hBSVJfRklMTCk7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmFuZ2xlID0gOTA7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmxlZnQgPSBsZWZ0T2Zmc2V0O1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XS50b3AgPSB0b3BPZmZzZXQ7XHJcbiAgICAgICsraW5kZXg7XHJcblxyXG4gICAgICB0b3BPZmZzZXQgKz0gKGNoYWlyV2lkdGggKyBnYXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIHJpZ2h0IGNoYWlyIHJvd1xyXG4gICAgZ2FwID0gKGRlZi5oZWlnaHQgLSAoZGVmLnJpZ2h0Q2hhaXJzICogY2hhaXJXaWR0aCkpIC8gKGRlZi5yaWdodENoYWlycyArIDEpO1xyXG4gICAgbGVmdE9mZnNldCA9IHRhYmxlUmVjdC53aWR0aCArIGNoYWlyV2lkdGggLyAyO1xyXG4gICAgdG9wT2Zmc2V0ID0gdGFibGVUb3AgKyBnYXAgKyBjaGFpcldpZHRoIC8gMjsgIC8vIHRvcCBvZiB0YWJsZSBwbHVzIGZpcnN0IGdhcCwgdGhlbiB0byBjZW50ZXJcclxuXHJcbiAgICBmb3IgKGxldCB4ID0gMDsgeCA8IGRlZi5yaWdodENoYWlyczsgeCsrKSB7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdID0gY3JlYXRlU2hhcGUoUkxfREVGQVVMVF9DSEFJUiwgUkxfQ0hBSVJfU1RST0tFLCBSTF9DSEFJUl9GSUxMKTtcclxuICAgICAgY29tcG9uZW50c1tpbmRleF0uYW5nbGUgPSAtOTA7XHJcbiAgICAgIGNvbXBvbmVudHNbaW5kZXhdLmxlZnQgPSBsZWZ0T2Zmc2V0ICsgY2hhaXJIZWlnaHQgLSAoUkxfQ0hBSVJfVFVDSyAqIDIpO1xyXG4gICAgICBjb21wb25lbnRzW2luZGV4XS50b3AgPSB0b3BPZmZzZXQ7XHJcbiAgICAgICsraW5kZXg7XHJcblxyXG4gICAgICB0b3BPZmZzZXQgKz0gKGNoYWlyV2lkdGggKyBnYXApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIGFkZCB0YWJsZSBvbiB0b3Agb2YgY2hhaXJzXHJcbiAgICBjb21wb25lbnRzW2luZGV4XSA9IG5ldyBmYWJyaWMuUmVjdCh0YWJsZVJlY3QpO1xyXG4gICAgY29tcG9uZW50c1tpbmRleF0ubGVmdCA9IHRhYmxlTGVmdDtcclxuICAgIGNvbXBvbmVudHNbaW5kZXhdLnRvcCA9IHRhYmxlVG9wO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgdGFibGVHcm91cCA9IG5ldyBmYWJyaWMuR3JvdXAoY29tcG9uZW50cywge1xyXG4gICAgbGVmdDogMCxcclxuICAgIHRvcDogMCxcclxuICAgIGhhc0NvbnRyb2xzOiBmYWxzZSxcclxuICAgIC8vIHNldCBvcmlnaW4gZm9yIGFsbCBncm91cHMgdG8gY2VudGVyXHJcbiAgICBvcmlnaW5YOiAnY2VudGVyJyxcclxuICAgIG9yaWdpblk6ICdjZW50ZXInLFxyXG4gICAgbmFtZTogZGVmPy5uYW1lICsgJztvcmRlcmlkO2l0ZW1OYW1lOycsXHJcbiAgICBib3JkZXJDb2xvcjogJ3B1cnBsZScsXHJcbiAgICBiYWNrZ3JvdW5kQ29sb3I6ICdwdXJwbGUnLFxyXG4gICAgc3Ryb2tlOiAncHVycGxlJyxcclxuICAgIHN0cm9rZVdpZHRoOiAxMCxcclxuICAgIGZpbGw6ICdwdXJwbGUnXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiB0YWJsZUdyb3VwO1xyXG59O1xyXG5cclxuZXhwb3J0IHtcclxuICBjcmVhdGVCYXNpY1NoYXBlLFxyXG4gIGNyZWF0ZVRhYmxlLFxyXG4gIGNyZWF0ZVNoYXBlLFxyXG4gIGNyZWF0ZVRleHQsXHJcbiAgY3JlYXRlRnVybml0dXJlLFxyXG5cclxuICBSTF9GSUxMLFxyXG4gIFJMX1NUUk9LRSxcclxuICBSTF9DSEFJUl9TVFJPS0UsXHJcbiAgUkxfQ0hBSVJfRklMTCxcclxuICBSTF9DSEFJUl9UVUNLLFxyXG4gIFJMX1BSRVZJRVdfSEVJR0hULFxyXG4gIFJMX1BSRVZJRVdfV0lEVEgsXHJcbiAgUkxfVklFV19XSURUSCxcclxuICBSTF9WSUVXX0hFSUdIVCxcclxuICBSTF9GT09ULFxyXG4gIFJMX0FJU0xFR0FQLFxyXG4gIFJMX1JPT01fT1VURVJfU1BBQ0lORyxcclxuICBSTF9ST09NX0lOTkVSX1NQQUNJTkcsXHJcbiAgUkxfUk9PTV9TVFJPS0UsXHJcbiAgUkxfQ09STkVSX0ZJTEwsXHJcbiAgUkxfVU5HUk9VUEFCTEVTLFxyXG4gIFJMX0NSRURJVF9URVhULFxyXG4gIFJMX0NSRURJVF9URVhUX1BBUkFNU1xyXG59O1xyXG4iXX0=